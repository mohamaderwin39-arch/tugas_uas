<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Pemakaian Bahan Bangunan</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #e9e9e9;
      margin: 0;
      padding: 0;
    }

    .header {
      width: 100%;
      padding: 18px;
      background: #2b2b2b;
      color: #f4c20d;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      letter-spacing: 1px;
      text-transform: uppercase;
      box-shadow: 0 3px 10px rgba(0,0,0,0.3);
    }

    .container {
      margin: 40px auto;
      max-width: 700px;
      background: #fff;
      padding: 25px;
      border-radius: 8px;
      border-top: 6px solid #f4c20d;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }

    h2 { margin-bottom: 15px; color: #333; text-align: center; }

    input, select {
      width: 100%;
      padding: 10px;
      margin: 8px 0 14px 0;
      border: 1px solid #bbb;
      border-radius: 5px;
      box-sizing: border-box;
      font-size: 15px;
    }

    label { font-weight: bold; color: #444; }

    button {
      width: 100%;
      background: #f4c20d;
      color: #2b2b2b;
      padding: 10px;
      border: none;
      font-size: 16px;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.2s;
      margin-top: 10px;
    }
    button:hover { background: #ffdd4c; }

    .captcha-box {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
    }

    .captcha-text {
      font-size: 1.3em;
      font-weight: bold;
      background: #eee;
      border: 1px dashed #555;
      padding: 3px 8px;
      letter-spacing: 3px;
      font-family: monospace;
      user-select: none;
    }

    .error {
      color: red;
      text-align: center;
      margin-bottom: 10px;
    }

    .hidden { display: none; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 25px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #f4c20d;
    }
    img.preview {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 4px;
      border: 1px solid #aaa;
    }
  </style>
</head>

<body>

<div class="header">Sistem Pemakaian Bahan Bangunan</div>

<div class="container">

  <!-- LOGIN -->
  <div id="loginSection">
    <h2>Login Pengguna</h2>
    <div id="error" class="error"></div>

    <form id="loginForm">
      <label>Username:</label>
      <input type="text" id="username" required>

      <label>Password:</label>
      <input type="password" id="password" required>

      <label>Captcha:</label>
      <div class="captcha-box">
        <span id="captcha" class="captcha-text"></span>
        <button type="button" onclick="generateCaptcha()" style="width:auto;padding:3px 8px;font-size:13px;">‚ü≥</button>
      </div>
      <input type="text" id="captchaInput" placeholder="Masukkan captcha..." required>

      <button type="submit">Masuk</button>
    </form>
  </div>

  <!-- FORM PEMAKAIAN -->
  <div id="formSection" class="hidden">
    <h2>Input Pemakaian Bahan</h2>

    <form id="pemakaianForm">

      <label>Nama Bahan:</label>
      <input type="text" id="nama_bahan" required>

      <label>Tanggal Pemakaian:</label>
      <input type="date" id="tgl" required>

      <label>Jumlah Dipakai:</label>
      <input type="number" id="jumlah" required>

      <label>Satuan:</label>
      <select id="satuan" required>
        <option value="Kg">Kg</option>
        <option value="Sak">Sak</option>
        <option value="Kubik">Kubik</option>
      </select>

      <label>Ket:</label>
      <input type="text" id="Ket" required>

      <label>Upload Foto Lokasi (opsional):</label>
      <input type="file" id="foto" accept="image/*">

      <button type="submit">Simpan</button>
    </form>

    <h2 style="margin-top:35px;">Rekap Pemakaian Bahan</h2>

    <table id="rekapTable">
      <thead>
        <tr>
          <th>No</th>
          <th>Nama Bahan</th>
          <th>Tanggal</th>
          <th>Jumlah</th>
          <th>Ket</th>
          <th>Foto</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

  </div>

</div>

<script>
/* -------------------- CAPTCHA -------------------- */
let currentCaptcha = '';

function generateCaptcha() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let c = '';
  for (let i = 0; i < 5; i++) {
    c += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  currentCaptcha = c;
  document.getElementById('captcha').textContent = c;
}
generateCaptcha();

/* -------------------- LOGIN -------------------- */
document.getElementById('loginForm').addEventListener('submit', function(e){
  e.preventDefault();

  if (document.getElementById('captchaInput').value.trim().toUpperCase() !== currentCaptcha) {
    document.getElementById('error').textContent = 'Captcha salah!';
    generateCaptcha();
    return;
  }

  const allowedUsers = [
    { username: "admin", password: "123456" },
    { username: "mandor", password: "mandor123" }
  ];

  let user = document.getElementById('username').value;
  let pass = document.getElementById('password').value;

  let valid = allowedUsers.some(u => u.username === user && u.password === pass);

  if (valid) {
    document.getElementById('loginSection').classList.add('hidden');
    document.getElementById('formSection').classList.remove('hidden');
  } else {
    document.getElementById('error').textContent = 'Username atau password salah!';
    generateCaptcha();
  }
});


/* -------------------- SIMPAN + REKAP -------------------- */

let nomor = 1;

document.getElementById('pemakaianForm').addEventListener('submit', function(e){
  e.preventDefault();

  let nama = document.getElementById('nama_bahan').value;
  let tgl = document.getElementById('tgl').value;
  let jumlah = document.getElementById('jumlah').value;
  let satuan = document.getElementById('satuan').value;
  let ket = document.getElementById('Ket').value;

  let file = document.getElementById('foto').files[0];

  let reader = new FileReader();

  reader.onload = function(event) {
    let fotoURL = event.target.result;

    let table = document.getElementById('rekapTable').querySelector('tbody');

    let row = `
      <tr>
        <td>${nomor++}</td>
        <td>${nama}</td>
        <td>${tgl}</td>
        <td>${jumlah} ${satuan}</td>
        <td>${ket}</td>
        <td>${file ? `<img src="${fotoURL}" class="preview">` : '-'}</td>
      </tr>
    `;

    table.innerHTML += row;
  };

  if (file) {
    reader.readAsDataURL(file);
  } else {
    reader.onload({ target: { result: null } });
  }

  document.getElementById('pemakaianForm').reset();
});
</script>

</body>
</html>
